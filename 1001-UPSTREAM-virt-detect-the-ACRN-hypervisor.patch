From 095b9cf45ad85dffff2e40752e74392484dfbcab Mon Sep 17 00:00:00 2001
From: Ross Burton <ross.burton@intel.com>
Date: Wed, 30 Jan 2019 16:40:41 +0000
Subject: [PATCH] virt: detect the ACRN hypervisor

Add magic string and enumeration for the ACRN hypervisor
(https://projectacrn.org).
---
 src/basic/virt.c | 3 +++
 src/basic/virt.h | 1 +
 2 files changed, 4 insertions(+)

diff --git a/src/basic/virt.c b/src/basic/virt.c
index c7376bf5e4..0717347b35 100644
--- a/src/basic/virt.c
+++ b/src/basic/virt.c
@@ -40,6 +40,8 @@ static int detect_vm_cpuid(void) {
                 /* https://wiki.freebsd.org/bhyve */
                 { "bhyve bhyve ", VIRTUALIZATION_BHYVE     },
                 { "QNXQVMBSQG",   VIRTUALIZATION_QNX       },
+                /* https://projectacrn.org */
+                { "ACRNACRNACRN", VIRTUALIZATION_ACRN      },
         };
 
         uint32_t eax, ebx, ecx, edx;
@@ -628,6 +630,7 @@ static const char *const virtualization_table[_VIRTUALIZATION_MAX] = {
         [VIRTUALIZATION_PARALLELS] = "parallels",
         [VIRTUALIZATION_BHYVE] = "bhyve",
         [VIRTUALIZATION_QNX] = "qnx",
+        [VIRTUALIZATION_ACRN] = "acrn",
         [VIRTUALIZATION_VM_OTHER] = "vm-other",
 
         [VIRTUALIZATION_SYSTEMD_NSPAWN] = "systemd-nspawn",
diff --git a/src/basic/virt.h b/src/basic/virt.h
index c4cf4bfeab..03cf1752f4 100644
--- a/src/basic/virt.h
+++ b/src/basic/virt.h
@@ -21,6 +21,7 @@ enum {
         VIRTUALIZATION_PARALLELS,
         VIRTUALIZATION_BHYVE,
         VIRTUALIZATION_QNX,
+        VIRTUALIZATION_ACRN,
         VIRTUALIZATION_VM_OTHER,
         VIRTUALIZATION_VM_LAST = VIRTUALIZATION_VM_OTHER,
 
-- 
2.20.1

